#!/usr/bin/env bash

export IMAGE=python:3.6.8-alpine3.9
export SOURCE=$DOCKER_PRIVATE_REGISTRY_HOST:$DOCKER_PRIVATE_REGISTRY_PULL_PORT/$IMAGE
export TARGET=$DOCKER_PRIVATE_REGISTRY_HOST:$DOCKER_PRIVATE_REGISTRY_PUSH_PORT/$IMAGE

echo $SOURCE
echo $TARGET
docker build -t $IMAGE --build-arg IMAGE=$SOURCE .
docker tag $IMAGE $TARGET
docker login $DOCKER_PRIVATE_REGISTRY_HOST:$DOCKER_PRIVATE_REGISTRY_PUSH_PORT -u $DOCKER_PRIVATE_REGISTRY_USER -p $DOCKER_PRIVATE_REGISTRY_PASSWORD

echo pushing $TARGET
docker push $TARGET
